#include "inputs.h"
#include "C:\Users\HLi\AppData\Roaming\Local Libraries\Local Documents\workspaceJava\WCET\TEST\iir\iir.h"
 

float iir_coefficients_inputs[20][5*4]= {{2.08474825e+38,9.27929419e+37,1.09814037e+38,2.12820375e+38,1.72593560e+38,1.14135727e+38,3.32677559e+38,1.54884082e+38,2.88382303e+38,8.81001784e+36,1.09502031e+38,3.47048677e+37,2.31980071e+38,7.07234714e+37,3.00896356e+38,2.76955894e+38,3.69802718e+37,2.99129484e+37,1.03267503e+37,1.25699030e+38},{1.25914482e+38,2.07562344e+38,2.37823808e+38,6.12130842e+37,5.10991878e+37,3.26300233e+38,6.87467104e+37,1.21222695e+38,1.81043381e+38,1.15025768e+38,5.07663188e+37,5.74473405e+37,6.15829340e+37,4.63387390e+37,1.50199305e+38,2.58507703e+38,2.94258702e+38,3.86526369e+37,1.78620681e+38,2.92457047e+38},{1.86181074e+38,1.51848539e+38,2.86044721e+38,3.04529279e+38,2.75317716e+37,1.55007562e+38,2.35524002e+38,8.54139294e+37,2.70551710e+38,7.14601934e+37,2.73338828e+38,2.42470138e+38,1.63097243e+38,9.36547973e+37,3.18975365e+38,2.95093373e+37,1.51752094e+38,1.11038310e+38,2.65075708e+37,1.43798750e+38},{4.36866271e+37,7.75918430e+37,9.72921791e+37,1.80678229e+38,3.16124580e+38,6.69031432e+37,2.70826505e+38,1.53374654e+38,2.54366563e+38,2.88433536e+38,1.08899260e+38,1.96589075e+38,1.35940836e+38,3.37233532e+38,2.26134776e+38,1.78560030e+37,1.31249847e+38,9.69219920e+37,1.90262581e+38,3.34090342e+38},{1.29631781e+38,2.03548299e+38,3.19600126e+38,2.55482437e+38,1.67523768e+38,1.44815775e+37,2.04015873e+37,7.50550246e+37,7.54770816e+37,2.13842329e+38,3.51200914e+37,3.63900170e+37,1.24777592e+38,1.35134803e+37,6.96946711e+37,5.50726198e+37,3.10626392e+38,5.99117884e+37,8.85927423e+37,2.54453774e+38},{5.94071042e+37,3.39119702e+38,1.44308417e+38,1.00481857e+38,7.91432090e+37,1.39245009e+38,1.54834784e+38,1.53797111e+37,1.85820121e+37,8.84844995e+37,2.58472362e+38,1.79493768e+38,4.18603801e+37,1.23591701e+38,2.79273122e+37,2.13094378e+38,1.82933360e+38,7.96655109e+37,1.97801427e+38,1.92243314e+38},{3.05592617e+38,1.11617685e+38,1.39663706e+37,1.73463798e+38,1.49260885e+37,2.84322611e+38,2.94139410e+38,2.72167605e+38,7.71438302e+37,2.31939373e+38,3.06153602e+38,2.18320676e+38,1.41511407e+38,2.68255294e+38,2.36471706e+38,1.62536271e+38,8.28885035e+37,1.26925900e+38,3.16070639e+35,1.14743313e+38},{7.81982532e+37,7.81473734e+37,3.21561819e+38,2.40853403e+38,3.00862564e+38,1.16482381e+38,1.49215802e+38,1.47220027e+38,9.21668648e+37,2.42457263e+38,1.46829911e+38,2.79461552e+38,7.82996117e+37,2.84903555e+38,8.86644481e+37,3.03724826e+38,1.13093693e+38,6.28058087e+37,3.94789522e+37,3.37448225e+38},{1.80928220e+38,2.55368872e+38,6.44969916e+37,1.14269401e+38,5.72307886e+37,2.49677774e+38,2.72564520e+37,1.53040760e+38,2.08241319e+38,2.58393285e+38,2.17323384e+38,5.22337859e+36,1.53686589e+38,2.88782939e+37,2.04225641e+38,2.86432875e+38,5.59294588e+37,4.67205938e+37,3.04642307e+37,4.25949999e+37},{9.81018323e+37,2.05713217e+38,1.77499649e+38,5.90469855e+37,2.08611513e+38,5.61384413e+37,2.21687294e+38,3.11477598e+38,1.49359678e+37,1.57807499e+38,1.65994308e+38,2.84914618e+38,1.64689382e+38,2.69884955e+38,1.70723823e+38,1.73135997e+38,8.44760125e+37,2.61895647e+38,1.07820147e+38,1.85971210e+38},{2.33406109e+37,2.30854996e+38,2.24920983e+38,3.23473107e+37,9.34677565e+37,8.65236987e+35,2.55840666e+38,1.22217079e+38,3.09491708e+38,2.65771345e+38,2.63038283e+37,4.00281622e+36,3.39185047e+38,2.30726949e+38,3.03636986e+38,2.40484117e+38,2.67828965e+38,9.74833664e+37,2.72674572e+37,1.19452152e+38},{2.78947237e+38,1.96921106e+38,3.59897960e+37,1.35969542e+38,3.11040733e+38,7.71370430e+37,6.70084637e+37,1.18308627e+38,1.18839514e+37,9.02982761e+37,1.45394844e+38,7.86690169e+37,2.60950007e+38,3.12517577e+37,3.11003382e+38,2.74888071e+38,1.20445881e+38,1.49390560e+38,2.13066014e+38,2.17923825e+38},{3.31575678e+37,1.20223763e+38,1.58504831e+38,7.20187763e+37,2.29518613e+38,2.71392143e+38,1.92692603e+38,2.85432890e+38,2.39637796e+38,9.10646438e+37,2.05791722e+38,1.27045045e+38,3.37760592e+38,1.35192978e+38,1.49951679e+38,2.09054686e+38,2.39414565e+38,2.39937317e+38,2.36196092e+38,1.27256618e+38},{3.05537109e+38,3.83403785e+37,3.27281431e+38,1.21112394e+38,2.76706840e+38,1.20357863e+38,2.60076186e+38,6.80218765e+37,2.79803513e+38,3.06206559e+38,1.09758677e+38,2.50334903e+38,2.55784265e+38,3.26953566e+37,4.57090951e+37,1.29118503e+38,9.47428680e+37,3.20383051e+38,4.13843725e+37,1.66402832e+38},{2.14002102e+38,2.54986485e+38,1.29450642e+38,2.91399216e+38,2.60700714e+38,2.47616632e+38,1.53354202e+38,1.22132933e+38,2.01276995e+38,9.13285858e+37,9.42037561e+37,1.62021252e+38,1.30754426e+37,9.85664632e+37,1.54367870e+38,3.37804126e+38,3.31701396e+38,3.24299492e+37,6.86524160e+37,7.15580259e+37},{8.97444733e+37,1.45010901e+37,3.22461743e+38,1.32367048e+37,5.79510790e+37,5.66721872e+37,8.11017444e+37,1.33150400e+38,2.66840270e+38,3.34224265e+38,2.04507783e+38,2.11802462e+38,1.17226426e+38,2.90333268e+38,1.72069269e+37,2.96518044e+38,7.56588669e+36,2.40864371e+38,2.29885735e+38,2.94792823e+38},{5.52154430e+37,2.96948353e+37,1.97344449e+38,2.57412503e+38,6.79384268e+37,5.22625554e+37,1.43045472e+38,1.96385304e+38,5.09143014e+37,7.90734662e+37,3.34862222e+38,3.14981185e+38,1.13345640e+38,1.79572199e+38,1.98120887e+38,4.55486114e+37,2.72728313e+38,2.72607164e+38,1.31951843e+37,3.38981901e+38},{3.19063115e+38,8.76117029e+37,1.65807871e+38,2.30747713e+38,3.32406264e+37,1.44935365e+38,3.18796915e+38,1.68513696e+38,2.08797389e+38,1.97161710e+38,2.80393042e+38,1.24757722e+38,2.97619807e+38,2.30756749e+38,2.15926196e+38,1.78217227e+38,1.02874557e+38,3.07579552e+38,2.18671309e+38,2.11776936e+38},{1.36544690e+38,2.14281908e+38,2.26245729e+38,1.65612602e+37,3.10345399e+38,1.58654012e+38,9.84179382e+37,4.23459530e+37,2.71715100e+38,2.61404237e+38,1.78077622e+38,1.07268065e+38,9.51727104e+37,1.59847171e+38,2.43473585e+38,8.34511425e+36,3.23232695e+38,2.11818351e+38,3.90347101e+37,2.20368683e+38},{2.25719726e+38,3.06513697e+38,1.23790575e+38,2.65542196e+38,1.35106718e+38,2.92814017e+37,2.41230194e+37,3.01686544e+38,3.91159654e+37,1.63516307e+38,2.73059251e+38,1.44174748e+38,3.13983426e+38,2.39530681e+36,1.75986488e+37,1.01097046e+37,8.22537384e+37,1.81178173e+38,2.71450094e+38,5.18094507e+37}};
float iir_wi_inputs[20][2*4]= {{1.80078726e+38,1.01653836e+38,9.18490328e+37,1.70560817e+38,2.98050270e+38,2.75373055e+38,1.97519127e+38,2.57096009e+38},{3.91057726e+37,3.04900160e+38,1.96710224e+37,5.52396891e+37,3.61301395e+37,1.48885557e+38,2.73187003e+38,3.52471207e+37},{1.88290832e+38,3.28384144e+38,3.21506375e+38,2.07736439e+38,1.42779038e+38,1.63980812e+38,8.58920797e+37,1.97121634e+38},{1.88677257e+38,1.53143657e+38,2.37505477e+38,6.66815750e+37,8.35635940e+37,2.04982881e+38,2.68324931e+38,8.82400120e+37},{1.97146688e+38,1.24581760e+38,2.71781978e+38,2.17810469e+38,6.46319030e+37,7.82565907e+36,1.84984915e+38,8.02692596e+37},{1.53709187e+38,2.35655340e+38,1.98186450e+38,3.14083615e+38,7.02748379e+37,2.50221798e+38,3.38769003e+38,1.15989608e+38},{6.00029330e+37,1.29644519e+38,1.93523690e+38,1.70979051e+38,9.65289013e+37,2.29407236e+38,1.80253901e+38,2.04262647e+38},{3.15562424e+37,1.04961996e+37,3.15243834e+38,7.31763552e+37,2.08924983e+38,8.23346512e+37,7.01728968e+37,2.34397809e+38},{3.86087241e+37,2.98137751e+38,9.40788600e+37,1.32448294e+38,1.14770495e+37,2.23710381e+38,3.16012347e+38,3.35030422e+38},{4.88578451e+37,5.10278485e+37,3.19674386e+38,1.95350338e+38,8.42599935e+36,6.57193569e+37,1.06450586e+38,1.01681405e+38},{2.56462112e+38,2.69689474e+38,2.55403682e+38,2.49432895e+38,8.06523147e+37,2.34014036e+38,1.75061979e+38,4.02737219e+37},{3.12924313e+38,2.90586361e+38,2.83936833e+38,2.71217773e+38,3.05883772e+38,2.09833995e+38,1.93985754e+38,9.06667059e+37},{7.51571166e+37,1.01754586e+38,1.49484026e+38,1.29229700e+38,1.70987814e+38,3.02010125e+38,8.50196486e+37,1.28088961e+38},{1.00138208e+38,2.19202460e+38,6.52754698e+37,2.15717299e+37,2.94107901e+38,3.27353564e+38,3.07388524e+38,5.41295875e+37},{8.09485029e+37,3.12589598e+38,2.19010625e+38,2.91067897e+38,1.53206813e+38,2.56991664e+38,1.65060251e+38,4.70437702e+37},{6.33293019e+37,2.87566832e+38,2.33093302e+38,2.47606779e+38,8.12894262e+37,2.92402678e+38,2.13467306e+38,2.28368960e+38},{3.21072313e+38,4.18206731e+37,3.30066666e+37,2.66195649e+37,1.34951063e+37,2.06880162e+38,1.10619684e+38,2.81650674e+38},{1.31537921e+38,2.70673889e+38,1.76842916e+38,3.18125947e+38,3.07564303e+38,1.03723576e+38,3.16186279e+38,5.68018423e+37},{9.04784483e+37,1.76695853e+38,2.90547034e+37,1.69133393e+38,2.15150208e+38,3.05552760e+38,1.73772527e+38,2.00913663e+38},{2.26593301e+38,1.39849097e+38,1.45290945e+38,1.81837015e+38,5.45673070e+37,1.96782947e+38,3.08328959e+38,7.99405601e+37}};
float iir_x_inputs[20] = {2.32714070e+38,1.38202133e+38,6.71306193e+37,3.28584542e+37,3.31098155e+38,2.19620137e+38,1.72489791e+38,3.24960580e+38,3.85197880e+37,6.31540286e+37,2.13019033e+38,9.18615641e+37,3.27851318e+38,3.23336138e+37,1.08668055e+38,3.17235092e+38,1.45477538e+38,4.07305046e+37,1.74880174e+37,2.86897089e+37};; 
 
 
/*Forward declaration*/

volatile float iir_coefficients_block[5*4];
volatile float iir_wi_block[2*4];
float iir_x_block;
 

void blockInputUpdate(int blockInputUpdate_i) 
{
	int iir_coefficients_block_counter0;
	for(iir_coefficients_block_counter0=0;iir_coefficients_block_counter0<5*4;iir_coefficients_block_counter0++){
		iir_coefficients_block[iir_coefficients_block_counter0]=iir_coefficients_inputs[blockInputUpdate_i][iir_coefficients_block_counter0];
	}

	int iir_wi_block_counter0;
	for(iir_wi_block_counter0=0;iir_wi_block_counter0<2*4;iir_wi_block_counter0++){
		iir_wi_block[iir_wi_block_counter0]=iir_wi_inputs[blockInputUpdate_i][iir_wi_block_counter0];
	}

	iir_x_block = iir_x_inputs[blockInputUpdate_i];
	 
	asm(
	/*store register values to register_address_block*/
	"sts	0xb43, r0\n\t"
	"sts	0xb44, r1\n\t"
	"sts	0xb45, r2\n\t"
	"sts	0xb46, r3\n\t"
	"sts	0xb47, r4\n\t"
	"sts	0xb48, r5\n\t"
	"sts	0xb49, r6\n\t"
	"sts	0xb4a, r7\n\t"
	"sts	0xb4b, r8\n\t"
	"sts	0xb4c, r9\n\t"
	"sts	0xb4d, r10\n\t"
	"sts	0xb4e, r11\n\t"
	"sts	0xb4f, r12\n\t"
	"sts	0xb50, r13\n\t"
	"sts	0xb51, r14\n\t"
	"sts	0xb52, r15\n\t"
	"sts	0xb53, r16\n\t"
	"sts	0xb54, r17\n\t"
	"sts	0xb55, r18\n\t"
	"sts	0xb56, r19\n\t"
	"sts	0xb57, r20\n\t"
	"sts	0xb58, r21\n\t"
	"sts	0xb59, r22\n\t"
	"sts	0xb5a, r23\n\t"
	"sts	0xb5b, r24\n\t"
	"sts	0xb5c, r25\n\t"
	"sts	0xb5d, r26\n\t"
	"sts	0xb5e, r27\n\t"
	"sts	0xb5f, r28\n\t"
	"sts	0xb60, r29\n\t"
	"sts	0xb61, r30\n\t"
	"sts	0xb62, r31\n\t"
	/*Assign the inputs values to the block*/
	/*restore register values to register_address_block*/
	"lds	r0, 0xb43\n\t"
	"lds	r1, 0xb44\n\t"
	"lds	r2, 0xb45\n\t"
	"lds	r3, 0xb46\n\t"
	"lds	r4, 0xb47\n\t"
	"lds	r5, 0xb48\n\t"
	"lds	r6, 0xb49\n\t"
	"lds	r7, 0xb4a\n\t"
	"lds	r8, 0xb4b\n\t"
	"lds	r9, 0xb4c\n\t"
	"lds	r10, 0xb4d\n\t"
	"lds	r11, 0xb4e\n\t"
	"lds	r12, 0xb4f\n\t"
	"lds	r13, 0xb50\n\t"
	"lds	r14, 0xb51\n\t"
	"lds	r15, 0xb52\n\t"
	"lds	r16, 0xb53\n\t"
	"lds	r17, 0xb54\n\t"
	"lds	r18, 0xb55\n\t"
	"lds	r19, 0xb56\n\t"
	"lds	r20, 0xb57\n\t"
	"lds	r21, 0xb58\n\t"
	"lds	r22, 0xb59\n\t"
	"lds	r23, 0xb5a\n\t"
	"lds	r24, 0xb5b\n\t"
	"lds	r25, 0xb5c\n\t"
	"lds	r26, 0xb5d\n\t"
	"lds	r27, 0xb5e\n\t"
	"lds	r28, 0xb5f\n\t"
	"lds	r29, 0xb60\n\t"
	"lds	r30, 0xb61\n\t"
	"lds	r31, 0xb62\n\t"
	);

} 
 
/*BLock execution time measurement*/
void benchmarkBlock(void)
{
	asm(
	/*store register values to register_address_block*/
	"sts	0xb43, r0\n\t"
	"sts	0xb44, r1\n\t"
	"sts	0xb45, r2\n\t"
	"sts	0xb46, r3\n\t"
	"sts	0xb47, r4\n\t"
	"sts	0xb48, r5\n\t"
	"sts	0xb49, r6\n\t"
	"sts	0xb4a, r7\n\t"
	"sts	0xb4b, r8\n\t"
	"sts	0xb4c, r9\n\t"
	"sts	0xb4d, r10\n\t"
	"sts	0xb4e, r11\n\t"
	"sts	0xb4f, r12\n\t"
	"sts	0xb50, r13\n\t"
	"sts	0xb51, r14\n\t"
	"sts	0xb52, r15\n\t"
	"sts	0xb53, r16\n\t"
	"sts	0xb54, r17\n\t"
	"sts	0xb55, r18\n\t"
	"sts	0xb56, r19\n\t"
	"sts	0xb57, r20\n\t"
	"sts	0xb58, r21\n\t"
	"sts	0xb59, r22\n\t"
	"sts	0xb5a, r23\n\t"
	"sts	0xb5b, r24\n\t"
	"sts	0xb5c, r25\n\t"
	"sts	0xb5d, r26\n\t"
	"sts	0xb5e, r27\n\t"
	"sts	0xb5f, r28\n\t"
	"sts	0xb60, r29\n\t"
	"sts	0xb61, r30\n\t"
	"sts	0xb62, r31\n\t"
	/*store stack pointer to stackpointer_address_block*/
	"in	r14, 0x3d\n\t"
	"in	r15, 0x3e\n\t"
	"sts	0x0b36, r14\n\t"
	"sts	0xb37, r15\n\t"
	/*store the stack to stack_address_block*/
	"ldi	r24, 0x00\n\t"
	"ldi	r25, 0x00\n\t"
	"lds	r26, 0x0b36\n\t"
	"lds	r27, 0xb37\n\t"
	"ldi	r30, 0x63\n\t"
	"ldi	r31, 0x0b\n\t"
	"ld     r14, X+\n\t"
	"st     Z+,	r14\n\t"
	"adiw	r24, 0x01\n\t"
	"cpi	r24, 0x25\n\t"
	"brne	.-10\n\t"
	/*set the stack to stack_address_org*/
	"ldi	r24, 0x00\n\t"
	"ldi	r25, 0x00\n\t"
	"lds	r26, 0x0b41\n\t"
	"lds	r27, 0xb42\n\t"
	"ldi	r30, 0x38\n\t"
	"ldi	r31, 0x0b\n\t"
	"ld     r14, Z+\n\t"
	"st     X+,	r14\n\t"
	"adiw	r24, 0x01\n\t"
	"cpi	r24, 0x9\n\t"
	"brne	.-10\n\t"
	/*set register values to register_address_org*/
	"lds	r0, 0xb14\n\t"
	"lds	r1, 0xb15\n\t"
	"lds	r2, 0xb16\n\t"
	"lds	r3, 0xb17\n\t"
	"lds	r4, 0xb18\n\t"
	"lds	r5, 0xb19\n\t"
	"lds	r6, 0xb1a\n\t"
	"lds	r7, 0xb1b\n\t"
	"lds	r8, 0xb1c\n\t"
	"lds	r9, 0xb1d\n\t"
	"lds	r10, 0xb1e\n\t"
	"lds	r11, 0xb1f\n\t"
	"lds	r12, 0xb20\n\t"
	"lds	r13, 0xb21\n\t"
	"lds	r14, 0xb22\n\t"
	"lds	r15, 0xb23\n\t"
	"lds	r16, 0xb24\n\t"
	"lds	r17, 0xb25\n\t"
	"lds	r18, 0xb26\n\t"
	"lds	r19, 0xb27\n\t"
	"lds	r20, 0xb28\n\t"
	"lds	r21, 0xb29\n\t"
	"lds	r22, 0xb2a\n\t"
	"lds	r23, 0xb2b\n\t"
	"lds	r24, 0xb2c\n\t"
	"lds	r25, 0xb2d\n\t"
	"lds	r26, 0xb2e\n\t"
	"lds	r27, 0xb2f\n\t"
	"lds	r28, 0xb30\n\t"
	"lds	r29, 0xb31\n\t"
	"lds	r30, 0xb32\n\t"
	"lds	r31, 0xb33\n\t"
	/*Tic*/
	"ldi	r24, 0x10\n\t"
	"out	0x08, r24\n\t"
	"lds	r24, 0xb2c\n\t"
	/*Block content*/
	"BlockContent_Start:\n\t"
	"lds r4, 0x0A7A\n\t"
	"lds r5, 0x0A7B\n\t"
	"lds r6, 0x0A7C\n\t"
	"lds r7, 0x0A7D\n\t"
	"BlockContent_End:\n\t"
	/*Toc*/
	"out	0x08, r1\n\t"
	/*set stack back to stack_address_block*/
	"ldi	r24, 0x00\n\t"
	"ldi	r25, 0x00\n\t"
	"lds	r26, 0x0b36\n\t"
	"lds	r27, 0xb37\n\t"
	"ldi	r30, 0x63\n\t"
	"ldi	r31, 0x0b\n\t"
	"ld     r14, Z+\n\t"
	"st     X+,	r14\n\t"
	"adiw	r24, 0x01\n\t"
	"cpi	r24, 0x25\n\t"
	"brne	.-10\n\t"
	/*restore register values to register_address_block*/
	"lds	r0, 0xb43\n\t"
	"lds	r1, 0xb44\n\t"
	"lds	r2, 0xb45\n\t"
	"lds	r3, 0xb46\n\t"
	"lds	r4, 0xb47\n\t"
	"lds	r5, 0xb48\n\t"
	"lds	r6, 0xb49\n\t"
	"lds	r7, 0xb4a\n\t"
	"lds	r8, 0xb4b\n\t"
	"lds	r9, 0xb4c\n\t"
	"lds	r10, 0xb4d\n\t"
	"lds	r11, 0xb4e\n\t"
	"lds	r12, 0xb4f\n\t"
	"lds	r13, 0xb50\n\t"
	"lds	r14, 0xb51\n\t"
	"lds	r15, 0xb52\n\t"
	"lds	r16, 0xb53\n\t"
	"lds	r17, 0xb54\n\t"
	"lds	r18, 0xb55\n\t"
	"lds	r19, 0xb56\n\t"
	"lds	r20, 0xb57\n\t"
	"lds	r21, 0xb58\n\t"
	"lds	r22, 0xb59\n\t"
	"lds	r23, 0xb5a\n\t"
	"lds	r24, 0xb5b\n\t"
	"lds	r25, 0xb5c\n\t"
	"lds	r26, 0xb5d\n\t"
	"lds	r27, 0xb5e\n\t"
	"lds	r28, 0xb5f\n\t"
	"lds	r29, 0xb60\n\t"
	"lds	r30, 0xb61\n\t"
	"lds	r31, 0xb62\n\t"
	/*restore the values in registers r14 and r15*/
	"lds	r14, 0xb51\n\t"
	"lds	r15, 0xb52\n\t"
	);


}
