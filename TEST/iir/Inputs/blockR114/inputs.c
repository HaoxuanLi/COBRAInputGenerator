#include "inputs.h"
#include "C:\Users\HLi\AppData\Roaming\Local Libraries\Local Documents\workspaceJava\WCET\TEST\iir\iir.h"
 

int f_inputs[20] = {7,2,2,5,6,3,6,7,2,6,3,1,5,0,3,6,4,0,7,6};;
float checksum_inputs[20] = {1.33717540e+38,3.13653533e+37,8.79232246e+37,2.34106361e+38,1.10562031e+38,1.82196783e+38,1.33428448e+38,2.25640138e+38,2.15788164e+38,1.12508980e+38,2.66510732e+38,2.75840656e+38,6.42695340e+37,4.59245563e+37,2.99316456e+38,2.59490878e+38,2.87408823e+38,1.09054291e+38,2.10115448e+38,2.02229898e+38};;
float iir_wi_inputs[20][2*4]= {{9.02197817e+37,4.92439294e+37,4.27808180e+36,9.35846222e+37,1.44684002e+38,1.20878174e+38,2.61527896e+37,1.92217103e+38},{1.03732861e+38,1.88619589e+38,1.71243101e+38,3.14256945e+38,1.70290222e+38,7.43030513e+37,8.52060457e+37,1.10739888e+38},{2.55608231e+38,2.52822695e+37,3.10317579e+38,2.29946576e+37,1.26891152e+38,2.39718547e+37,2.48317528e+38,1.55778897e+38},{1.26663863e+38,3.22539442e+38,1.29375836e+38,2.74004176e+38,1.57836310e+38,2.02967342e+38,1.32427137e+38,2.51164198e+38},{2.48335395e+38,1.78690998e+38,2.49998637e+38,1.05227552e+38,2.17398636e+38,2.12884144e+38,6.77004284e+36,2.81294299e+38},{2.72324383e+38,2.62538041e+38,1.80148226e+38,2.56735500e+38,1.85916395e+37,2.83932165e+38,1.84819074e+37,1.87605543e+38},{2.08531053e+38,1.71453444e+37,2.86893945e+38,2.37604720e+38,1.75505766e+38,2.54940667e+38,2.01888193e+38,1.49127872e+38},{2.49137548e+38,6.60073939e+36,2.70305681e+38,2.56767244e+38,1.58934284e+38,2.50939236e+38,1.51385096e+38,1.30122043e+38},{7.28322415e+37,2.95863979e+38,3.82117152e+36,2.68254091e+38,6.46592971e+36,6.17970907e+37,9.14171494e+36,2.17255135e+37},{2.50021305e+38,1.88776716e+38,3.38708194e+38,1.65955219e+38,2.78664218e+37,2.32582099e+38,7.31129804e+37,2.20091848e+38},{1.51778054e+38,6.29713567e+37,2.64082409e+38,2.86768579e+38,1.80302829e+38,1.89414279e+38,1.45389678e+38,2.98827928e+38},{1.53946162e+38,1.56582947e+38,2.22287055e+38,6.77792878e+37,2.31966526e+38,4.60561534e+37,2.15901814e+36,1.49284326e+38},{1.03733382e+38,2.57248015e+38,4.95458236e+37,2.64347652e+38,8.98332871e+36,1.28485522e+38,2.30879163e+37,3.51857108e+37},{2.46406093e+38,2.95093318e+38,2.65604779e+38,2.26867447e+38,1.17192025e+38,1.33555064e+38,2.93943511e+38,9.00491223e+37},{2.72987501e+38,1.33653472e+37,1.05518895e+38,2.97093479e+38,3.17078339e+38,2.75404215e+38,1.59437820e+38,1.19751095e+38},{2.19117386e+38,3.25702403e+38,8.28494890e+37,1.53373767e+38,2.02353129e+38,2.41485872e+37,1.89550877e+38,7.85689425e+37},{1.85519446e+38,2.84562427e+38,1.30524929e+38,2.11441506e+36,2.07206861e+38,5.17583700e+37,1.92701568e+38,3.28856712e+38},{1.65987529e+38,2.69901058e+38,1.60696324e+38,3.37569339e+37,6.20717453e+37,5.70978037e+37,1.63730740e+38,1.64064761e+38},{3.03414125e+38,1.21508061e+38,3.09510197e+38,2.59366779e+38,1.66230905e+38,2.36495519e+38,2.70139002e+38,4.40717370e+37},{3.08076883e+38,9.95980426e+37,1.83137099e+38,3.25982392e+38,5.91167593e+37,4.33511789e+37,1.10605444e+38,3.18112723e+37}}; 
 
 
/*Forward declaration*/

int f_block;
float checksum_block;
volatile float iir_wi_block[2*4];
 

void blockInputUpdate(int blockInputUpdate_i) 
{
	f_block = f_inputs[blockInputUpdate_i];
	checksum_block = checksum_inputs[blockInputUpdate_i];
	int iir_wi_block_counter0;
	for(iir_wi_block_counter0=0;iir_wi_block_counter0<2*4;iir_wi_block_counter0++){
		iir_wi_block[iir_wi_block_counter0]=iir_wi_inputs[blockInputUpdate_i][iir_wi_block_counter0];
	}

	 
	asm(
	/*store register values to register_address_block*/
	"sts	0x4dd, r0\n\t"
	"sts	0x4de, r1\n\t"
	"sts	0x4df, r2\n\t"
	"sts	0x4e0, r3\n\t"
	"sts	0x4e1, r4\n\t"
	"sts	0x4e2, r5\n\t"
	"sts	0x4e3, r6\n\t"
	"sts	0x4e4, r7\n\t"
	"sts	0x4e5, r8\n\t"
	"sts	0x4e6, r9\n\t"
	"sts	0x4e7, r10\n\t"
	"sts	0x4e8, r11\n\t"
	"sts	0x4e9, r12\n\t"
	"sts	0x4ea, r13\n\t"
	"sts	0x4eb, r14\n\t"
	"sts	0x4ec, r15\n\t"
	"sts	0x4ed, r16\n\t"
	"sts	0x4ee, r17\n\t"
	"sts	0x4ef, r18\n\t"
	"sts	0x4f0, r19\n\t"
	"sts	0x4f1, r20\n\t"
	"sts	0x4f2, r21\n\t"
	"sts	0x4f3, r22\n\t"
	"sts	0x4f4, r23\n\t"
	"sts	0x4f5, r24\n\t"
	"sts	0x4f6, r25\n\t"
	"sts	0x4f7, r26\n\t"
	"sts	0x4f8, r27\n\t"
	"sts	0x4f9, r28\n\t"
	"sts	0x4fa, r29\n\t"
	"sts	0x4fb, r30\n\t"
	"sts	0x4fc, r31\n\t"
	/*Assign the inputs values to the block*/
	"lds	r25, 0x4aa\n\t"
	"sts	0x4c7, r25\n\t"
	"lds	r24, 0x4ab\n\t"
	"sts	0x4c6, r24\n\t"
	/*restore register values to register_address_block*/
	"lds	r0, 0x4dd\n\t"
	"lds	r1, 0x4de\n\t"
	"lds	r2, 0x4df\n\t"
	"lds	r3, 0x4e0\n\t"
	"lds	r4, 0x4e1\n\t"
	"lds	r5, 0x4e2\n\t"
	"lds	r6, 0x4e3\n\t"
	"lds	r7, 0x4e4\n\t"
	"lds	r8, 0x4e5\n\t"
	"lds	r9, 0x4e6\n\t"
	"lds	r10, 0x4e7\n\t"
	"lds	r11, 0x4e8\n\t"
	"lds	r12, 0x4e9\n\t"
	"lds	r13, 0x4ea\n\t"
	"lds	r14, 0x4eb\n\t"
	"lds	r15, 0x4ec\n\t"
	"lds	r16, 0x4ed\n\t"
	"lds	r17, 0x4ee\n\t"
	"lds	r18, 0x4ef\n\t"
	"lds	r19, 0x4f0\n\t"
	"lds	r20, 0x4f1\n\t"
	"lds	r21, 0x4f2\n\t"
	"lds	r22, 0x4f3\n\t"
	"lds	r23, 0x4f4\n\t"
	"lds	r24, 0x4f5\n\t"
	"lds	r25, 0x4f6\n\t"
	"lds	r26, 0x4f7\n\t"
	"lds	r27, 0x4f8\n\t"
	"lds	r28, 0x4f9\n\t"
	"lds	r29, 0x4fa\n\t"
	"lds	r30, 0x4fb\n\t"
	"lds	r31, 0x4fc\n\t"
	);

} 
 
/*BLock execution time measurement*/
void benchmarkBlock(void)
{
	asm(
	/*store register values to register_address_block*/
	"sts	0x4dd, r0\n\t"
	"sts	0x4de, r1\n\t"
	"sts	0x4df, r2\n\t"
	"sts	0x4e0, r3\n\t"
	"sts	0x4e1, r4\n\t"
	"sts	0x4e2, r5\n\t"
	"sts	0x4e3, r6\n\t"
	"sts	0x4e4, r7\n\t"
	"sts	0x4e5, r8\n\t"
	"sts	0x4e6, r9\n\t"
	"sts	0x4e7, r10\n\t"
	"sts	0x4e8, r11\n\t"
	"sts	0x4e9, r12\n\t"
	"sts	0x4ea, r13\n\t"
	"sts	0x4eb, r14\n\t"
	"sts	0x4ec, r15\n\t"
	"sts	0x4ed, r16\n\t"
	"sts	0x4ee, r17\n\t"
	"sts	0x4ef, r18\n\t"
	"sts	0x4f0, r19\n\t"
	"sts	0x4f1, r20\n\t"
	"sts	0x4f2, r21\n\t"
	"sts	0x4f3, r22\n\t"
	"sts	0x4f4, r23\n\t"
	"sts	0x4f5, r24\n\t"
	"sts	0x4f6, r25\n\t"
	"sts	0x4f7, r26\n\t"
	"sts	0x4f8, r27\n\t"
	"sts	0x4f9, r28\n\t"
	"sts	0x4fa, r29\n\t"
	"sts	0x4fb, r30\n\t"
	"sts	0x4fc, r31\n\t"
	/*store stack pointer to stackpointer_address_block*/
	"in	r14, 0x3d\n\t"
	"in	r15, 0x3e\n\t"
	"sts	0x04d0, r14\n\t"
	"sts	0x4d1, r15\n\t"
	/*store the stack to stack_address_block*/
	"ldi	r24, 0x00\n\t"
	"ldi	r25, 0x00\n\t"
	"lds	r26, 0x04d0\n\t"
	"lds	r27, 0x4d1\n\t"
	"ldi	r30, 0xfd\n\t"
	"ldi	r31, 0x04\n\t"
	"ld     r14, X+\n\t"
	"st     Z+,	r14\n\t"
	"adiw	r24, 0x01\n\t"
	"cpi	r24, 0x25\n\t"
	"brne	.-10\n\t"
	/*set the stack to stack_address_org*/
	"ldi	r24, 0x00\n\t"
	"ldi	r25, 0x00\n\t"
	"lds	r26, 0x04db\n\t"
	"lds	r27, 0x4dc\n\t"
	"ldi	r30, 0xd2\n\t"
	"ldi	r31, 0x04\n\t"
	"ld     r14, Z+\n\t"
	"st     X+,	r14\n\t"
	"adiw	r24, 0x01\n\t"
	"cpi	r24, 0x9\n\t"
	"brne	.-10\n\t"
	/*set register values to register_address_org*/
	"lds	r0, 0x4ae\n\t"
	"lds	r1, 0x4af\n\t"
	"lds	r2, 0x4b0\n\t"
	"lds	r3, 0x4b1\n\t"
	"lds	r4, 0x4b2\n\t"
	"lds	r5, 0x4b3\n\t"
	"lds	r6, 0x4b4\n\t"
	"lds	r7, 0x4b5\n\t"
	"lds	r8, 0x4b6\n\t"
	"lds	r9, 0x4b7\n\t"
	"lds	r10, 0x4b8\n\t"
	"lds	r11, 0x4b9\n\t"
	"lds	r12, 0x4ba\n\t"
	"lds	r13, 0x4bb\n\t"
	"lds	r14, 0x4bc\n\t"
	"lds	r15, 0x4bd\n\t"
	"lds	r16, 0x4be\n\t"
	"lds	r17, 0x4bf\n\t"
	"lds	r18, 0x4c0\n\t"
	"lds	r19, 0x4c1\n\t"
	"lds	r20, 0x4c2\n\t"
	"lds	r21, 0x4c3\n\t"
	"lds	r22, 0x4c4\n\t"
	"lds	r23, 0x4c5\n\t"
	"lds	r24, 0x4c6\n\t"
	"lds	r25, 0x4c7\n\t"
	"lds	r26, 0x4c8\n\t"
	"lds	r27, 0x4c9\n\t"
	"lds	r28, 0x4ca\n\t"
	"lds	r29, 0x4cb\n\t"
	"lds	r30, 0x4cc\n\t"
	"lds	r31, 0x4cd\n\t"
	/*Tic*/
	"ldi	r24, 0x10\n\t"
	"out	0x08, r24\n\t"
	"lds	r24, 0x4c6\n\t"
	/*Block content*/
	"BlockContent_Start:\n\t"
	"ldi r28, 0x00\n\t"
	"ldi r29, 0x00\n\t"
	"ldi r22, 0x00\n\t"
	"ldi r23, 0x00\n\t"
	"movw r24, r22\n\t"
	"movw r30, r28\n\t"
	"add r30, r30\n\t"
	"adc r31, r31\n\t"
	"add r30, r30\n\t"
	"adc r31, r31\n\t"
	"subi r30, 0x9A\n\t"
	"sbci r31, 0xFB\n\t"
	"ld r18, Z\n\t"
	"ldd r19, Z+1\n\t"
	"ldd r20, Z+2\n\t"
	"ldd r21, Z+3\n\t"
	"rcall .+646\n\t"    //0x906
	"adiw r28, 0x01\n\t"
	"cpi r28, 0x08\n\t"
	"cpc r29, r1\n\t"
	"brne .-32\n\t"
	"BlockContent_End:\n\t"
	/*Toc*/
	"out	0x08, r1\n\t"
	/*set stack back to stack_address_block*/
	"ldi	r24, 0x00\n\t"
	"ldi	r25, 0x00\n\t"
	"lds	r26, 0x04d0\n\t"
	"lds	r27, 0x4d1\n\t"
	"ldi	r30, 0xfd\n\t"
	"ldi	r31, 0x04\n\t"
	"ld     r14, Z+\n\t"
	"st     X+,	r14\n\t"
	"adiw	r24, 0x01\n\t"
	"cpi	r24, 0x25\n\t"
	"brne	.-10\n\t"
	/*restore register values to register_address_block*/
	"lds	r0, 0x4dd\n\t"
	"lds	r1, 0x4de\n\t"
	"lds	r2, 0x4df\n\t"
	"lds	r3, 0x4e0\n\t"
	"lds	r4, 0x4e1\n\t"
	"lds	r5, 0x4e2\n\t"
	"lds	r6, 0x4e3\n\t"
	"lds	r7, 0x4e4\n\t"
	"lds	r8, 0x4e5\n\t"
	"lds	r9, 0x4e6\n\t"
	"lds	r10, 0x4e7\n\t"
	"lds	r11, 0x4e8\n\t"
	"lds	r12, 0x4e9\n\t"
	"lds	r13, 0x4ea\n\t"
	"lds	r14, 0x4eb\n\t"
	"lds	r15, 0x4ec\n\t"
	"lds	r16, 0x4ed\n\t"
	"lds	r17, 0x4ee\n\t"
	"lds	r18, 0x4ef\n\t"
	"lds	r19, 0x4f0\n\t"
	"lds	r20, 0x4f1\n\t"
	"lds	r21, 0x4f2\n\t"
	"lds	r22, 0x4f3\n\t"
	"lds	r23, 0x4f4\n\t"
	"lds	r24, 0x4f5\n\t"
	"lds	r25, 0x4f6\n\t"
	"lds	r26, 0x4f7\n\t"
	"lds	r27, 0x4f8\n\t"
	"lds	r28, 0x4f9\n\t"
	"lds	r29, 0x4fa\n\t"
	"lds	r30, 0x4fb\n\t"
	"lds	r31, 0x4fc\n\t"
	/*restore the values in registers r14 and r15*/
	"lds	r14, 0x4eb\n\t"
	"lds	r15, 0x4ec\n\t"
	);


}
